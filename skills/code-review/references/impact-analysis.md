# 影響範囲分析ガイド

変更されたコードが他の部分にどのような影響を与えるかを分析する手順。

## 分析フロー

```
1. 変更された関数・クラス・メソッドを特定
   ↓
2. 直接の呼び出し元を検索（Grepで関数名を検索）
   ↓
3. 間接的な呼び出しチェーンをたどる
   ↓
4. テストファイルへの影響を確認
   ↓
5. 設定・スキーマへの影響を確認
```

## 1. 変更された要素の特定

diffから以下を抽出:

- 変更された関数・メソッド名
- 変更されたクラス名
- 変更されたエクスポート（export）
- シグネチャ（引数・戻り値）の変更

## 2. 直接の呼び出し元を検索

```bash
# 関数名で検索
grep -r "functionName" --include="*.ts" --include="*.js"

# メソッド呼び出しで検索
grep -r "\.methodName(" --include="*.ts" --include="*.js"

# importで検索
grep -r "import.*functionName" --include="*.ts" --include="*.js"
```

## 3. 間接的な影響の調査

直接の呼び出し元が見つかったら、その呼び出し元も同様に調査:

```
変更した関数A
  ↑ 呼び出し元B（調査済み）
    ↑ 呼び出し元C（追加で調査）
      ↑ 呼び出し元D（影響が大きい場合のみ）
```

**調査を深める判断基準:**

- 戻り値の型が変更された場合 → 必ず追跡
- 例外の種類が変更された場合 → 必ず追跡
- 引数の追加・削除がある場合 → 必ず追跡
- 内部ロジックのみの変更 → 1階層で十分

## 4. テストへの影響

```bash
# テストファイルで変更された関数を検索
grep -r "functionName" --include="*.test.ts" --include="*.spec.ts"
```

確認事項:

- 既存テストが変更後も有効か
- 新しいテストケースが必要か
- モックの更新が必要か

## 5. 設定・スキーマへの影響

以下のファイルをチェック:

- `*.config.js` / `*.config.ts`
- `schema.prisma` / `*.graphql`
- `package.json`（依存関係）
- `tsconfig.json`（型設定）
- 環境変数ファイル（`.env*`）

## 影響範囲の報告フォーマット

```markdown
### 影響範囲分析

#### 変更された要素
- `UserService.getUser()`: 戻り値の型を変更

#### 直接の呼び出し元（3箇所）
| ファイル | 行 | 影響 |
|---------|-----|------|
| `api/user.ts` | 42 | 型エラーの可能性あり |
| `components/Profile.tsx` | 28 | 修正必要 |
| `tests/user.test.ts` | 15 | テスト更新必要 |

#### 間接的な影響（2箇所）
- `api/user.ts` → `routes/index.ts`:45 → 影響軽微
- `components/Profile.tsx` → `pages/UserPage.tsx`:12 → 確認推奨

#### 推奨アクション
1. `components/Profile.tsx`の型定義を更新
2. `tests/user.test.ts`のテストケースを追加
```
